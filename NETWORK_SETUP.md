# 网络请求配置指南

## 问题说明

微信开发者工具对本地 IP 地址（如 `172.16.1.221`）的 HTTP 请求可能返回 502 Bad Gateway 错误。这是因为微信开发者工具的网络代理机制导致的。

## 解决方案

### 方案 1：使用真机调试（推荐）⭐

**优点**：最简单，无需额外配置  
**缺点**：需要在真机上测试

1. 在微信开发者工具中点击"预览"
2. 用微信扫描二维码
3. 在真机上打开小程序
4. 真机可以正常访问内网服务器

### 方案 2：使用本地代理服务器

**优点**：可以在开发者工具中测试  
**缺点**：需要运行额外的代理服务器

#### 步骤：

1. **启动代理服务器**
   ```bash
   node proxy-server.js
   ```

2. **修改 API 地址**
   编辑 `miniprogram/utils/api.js`，将：
   ```javascript
   const API_BASE_URL = 'http://172.16.1.221:6999/game';
   ```
   改为：
   ```javascript
   const API_BASE_URL = 'http://localhost:3000/proxy/game';
   ```

3. **重新编译小程序**
   - 代理服务器会在 `http://localhost:3000` 上运行
   - 所有请求会被转发到 `http://172.16.1.221:6999`

### 方案 3：使用模拟数据（临时方案）

**优点**：可以继续开发其他功能  
**缺点**：无法测试真实 API

编辑 `miniprogram/utils/api.js`，将：
```javascript
const USE_MOCK_DATA = false;
```
改为：
```javascript
const USE_MOCK_DATA = true;
```

这样会跳过服务器请求，直接使用模拟数据。

## 当前配置

- **API 地址**: `http://172.16.1.221:6999/game`
- **使用模拟数据**: `false`（在 `miniprogram/utils/api.js` 中配置）

## 调试提示

1. **查看控制台日志**
   - 打开微信开发者工具的控制台
   - 查看请求和响应的详细信息

2. **检查网络请求**
   - 在开发者工具的"Network"面板中查看请求详情
   - 确认请求是否发出，以及响应状态码

3. **验证服务器**
   - 在浏览器中访问 `http://172.16.1.221:6999/game`
   - 确认服务器正常运行

## 常见错误

### 502 Bad Gateway
- **原因**：微信开发者工具无法访问本地 IP
- **解决**：使用方案 1（真机调试）或方案 2（代理服务器）

### 网络请求失败
- **原因**：服务器未运行或网络不通
- **解决**：检查服务器状态和网络连接

### 解析数据失败
- **原因**：服务器返回格式不正确
- **解决**：检查服务器返回的 JSON 格式
