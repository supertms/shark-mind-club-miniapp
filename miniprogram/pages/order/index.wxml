<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="header-title">ç‚¹é¤</text>
    <text class="header-close" bindtap="onBack">âœ•</text>
  </view>

  <!-- ä¸»å†…å®¹ -->
  <view class="main-content">
    <!-- åˆ†ç±»ä¾§è¾¹æ  -->
    <view class="category-sidebar">
      <view
        wx:for="{{categories}}"
        wx:key="id"
        class="category-item {{selectedCategory === item.id ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="{{item.id}}"
      >
        <text class="category-icon">
          {{item.icon === 'gift' ? 'ğŸ' : item.icon === 'cookie' ? 'ğŸª' : item.icon === 'beer' ? 'ğŸº' : item.icon === 'wine' ? 'ğŸ·' : item.icon === 'cup-soda' ? 'ğŸ¥¤' : item.icon === 'clock' ? 'â°' : 'ğŸ“¦'}}
        </text>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>

    <!-- å•†å“åˆ—è¡¨åŒºåŸŸ -->
    <view class="products-area">
      <!-- è¿›è¡Œä¸­è®¢å• -->
      <view wx:if="{{selectedCategory === 'ongoing-orders'}}" class="orders-list">
        <view
          wx:for="{{ongoingOrders}}"
          wx:key="id"
          class="order-card"
        >
          <view class="order-header">
            <view class="order-time-info">
              <text class="order-time-label">è®¢å•æ—¶é—´</text>
              <text class="order-time">{{item.orderTime}}</text>
            </view>
            <view class="order-status">è¿›è¡Œä¸­</view>
          </view>

          <view class="order-items">
            <view
              wx:for="{{item.items}}"
              wx:for-item="orderItem"
              wx:key="index"
              class="order-item-row"
            >
              <text class="order-item-name">
                {{orderItem.product.name}}
                <text wx:if="{{orderItem.variant}}" class="order-item-variant">({{orderItem.variant}})</text>
                <text class="order-item-quantity">x{{orderItem.quantity}}</text>
              </text>
              <text class="order-item-price">Â¥{{orderItem.formattedPrice}}</text>
            </view>
          </view>

          <view class="order-total">
            <text class="order-total-label">è®¢å•æ€»è®¡</text>
            <text class="order-total-price">Â¥{{item.formattedTotal}}</text>
          </view>
        </view>

        <view wx:if="{{ongoingOrders.length === 0}}" class="empty-orders">
          <text class="empty-text">æš‚æ— è¿›è¡Œä¸­çš„è®¢å•</text>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <scroll-view wx:else class="products-list" scroll-y="true">
        <view
          wx:for="{{filteredProducts}}"
          wx:key="id"
          class="product-card {{selectedCategory === 'general-package' ? 'package-card' : ''}}"
        >
          <!-- å•†å“å›¾ç‰‡ -->
          <view class="product-image {{selectedCategory === 'general-package' ? 'package-image' : ''}}">
            <image src="{{item.image}}" mode="aspectFill" />
            <view class="image-overlay"></view>
          </view>

          <!-- å•†å“ä¿¡æ¯ -->
          <view class="product-info">
            <view class="product-header">
              <text class="product-name {{selectedCategory === 'general-package' ? 'package-name' : ''}}">{{item.name}}</text>
              <text wx:if="{{item.description}}" class="product-description {{selectedCategory === 'general-package' ? 'package-description' : ''}}">{{item.description}}</text>
            </view>

            <!-- ä»·æ ¼å’Œæ§åˆ¶æŒ‰é’® -->
            <view class="product-controls">
              <text class="product-price {{selectedCategory === 'general-package' ? 'package-price' : ''}}">Â¥{{item.formattedPrice}}</text>

              <!-- æ·»åŠ /ç§»é™¤æŒ‰é’® -->
              <view wx:if="{{item.quantity > 0}}" class="quantity-controls">
                <button
                  class="quantity-btn minus"
                  bindtap="onRemoveFromCart"
                  data-product-id="{{item.id}}"
                >
                  <text>âˆ’</text>
                </button>
                <text class="quantity-text">{{item.quantity}}</text>
                <button
                  class="quantity-btn plus"
                  bindtap="onAddToCart"
                  data-product-id="{{item.id}}"
                >
                  <text>+</text>
                </button>
              </view>
              <button
                wx:else
                class="add-btn {{selectedCategory === 'general-package' ? 'package-add-btn' : ''}}"
                bindtap="onAddToCart"
                data-product-id="{{item.id}}"
              >
                <text wx:if="{{selectedCategory === 'general-package'}}">æ·»åŠ </text>
                <text wx:else>+</text>
              </button>
            </view>
          </view>
        </view>

        <view wx:if="{{filteredProducts.length === 0}}" class="empty-products">
          <text class="empty-text">è¯¥åˆ†ç±»æš‚æ— å•†å“</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- åº•éƒ¨è´­ç‰©è½¦æ  -->
  <view wx:if="{{selectedCategory !== 'ongoing-orders' && cartCount > 0}}" class="cart-bar">
    <view class="cart-summary">
      <view class="cart-total-info">
        <text class="cart-label">åˆè®¡</text>
        <text class="cart-total">Â¥{{formattedCartTotal}}</text>
      </view>
      <text class="cart-count">å…±{{cartCount}}ä»¶å•†å“</text>
    </view>
    <button class="checkout-btn" bindtap="onShowCheckoutModal">ç»“ç®—</button>
  </view>

  <!-- ç»“ç®—ç¡®è®¤æ¨¡æ€æ¡† -->
  <view wx:if="{{showCheckoutModal}}" class="modal-overlay" bindtap="onCloseCheckoutModal">
    <view class="modal-content checkout-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">ç¡®è®¤è®¢å•</text>
        <text class="modal-close" bindtap="onCloseCheckoutModal">âœ•</text>
      </view>
      <view class="modal-body">
          <view class="checkout-items">
            <view
              wx:for="{{cart}}"
              wx:key="index"
              class="checkout-item"
            >
              <text class="checkout-item-name">{{item.product.name}}</text>
              <text class="checkout-item-quantity">x{{item.quantity}}</text>
              <text class="checkout-item-price">Â¥{{item.formattedPrice}}</text>
            </view>
          </view>
          <view class="checkout-total">
            <text class="checkout-total-label">æ€»è®¡</text>
            <text class="checkout-total-price">Â¥{{formattedCartTotal}}</text>
          </view>
        <button class="confirm-btn" bindtap="onConfirmOrder">ç¡®è®¤ä¸‹å•</button>
      </view>
    </view>
  </view>
</view>